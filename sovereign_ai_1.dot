digraph Tier7_Sovereign_AI {

    rankdir=LR;
    compound=true;
    nodesep=0.8;
    ranksep=1.2;

    node [shape=box, style=rounded, fontname="JetBrains Mono"];
    edge [fontname="JetBrains Mono"];

    /* ============================================================
       TIER 7 — SOVEREIGN EXECUTION ARCHITECTURE
       ============================================================ */

    /* ---------- LAYER 1 : INPUT ---------- */

    subgraph cluster_input {
        label="Layer 1 — Input Surface";
        style=rounded;

        DSL              [label="DSL / Intent\n(text, API, CLI)"];
        ExternalSignals  [label="External Signals\n(events, files, net)"];
    }

    /* ---------- LAYER 2 : STRUCTURE ---------- */

    subgraph cluster_structure {
        label="Layer 2 — Structural Truth";
        style=rounded;

        Proposal         [label="Proposal\n(raw graph intent)"];
        Resolver         [label="Resolver\n(bind ids, names)"];
        CanonicalIR      [label="CanonicalIR\n(validated DAG)"];
    }

    /* ---------- LAYER 3 : GOVERNANCE ---------- */

    subgraph cluster_governance {
        label="Layer 3 — Governance (Judgment)";
        style=rounded;

        Policy           [label="Policy Engine\n(lints, laws)"];
        ProofSystem      [label="Proof System\n(structure/execution/meta)"];
        Gate             [label="Gate\n(accept / reject)"];
    }

    /* ---------- LAYER 4 : KERNEL ---------- */

    subgraph cluster_kernel {
        label="Layer 4 — Deterministic Kernel";
        style=rounded;

        StateModel       [label="Canonical State"];
        DeltaEngine      [label="Delta Engine"];
        Kernel           [label="Kernel\n(apply verified delta)"];
    }

    /* ---------- LAYER 5 : MEMORY ---------- */

    subgraph cluster_memory {
        label="Layer 5 — Sovereign Memory";
        style=rounded;

        Epochs           [label="Epoch Manager"];
        Ledger           [label="Append-Only Ledger"];
        Snapshot         [label="Snapshot / Merkle Root"];
    }

    /* ---------- LAYER 6 : EXECUTION ---------- */

    subgraph cluster_execution {
        label="Layer 6 — Runtime Execution";
        style=rounded;

        Interpreter      [label="System Interpreter"];
        Scheduler        [label="Scheduler"];
        HostAdapter      [label="Host Adapter\n(shell / fs / gpu)"];
    }

    /* ---------- LAYER 7 : OBSERVATION ---------- */

    subgraph cluster_observe {
        label="Layer 7 — Observation & Feedback";
        style=rounded;

        EventStream      [label="Execution Events"];
        Scoring          [label="Scoring / Metrics"];
        Learning         [label="Learning Layer\n(optional)"];
    }

    /* ============================================================
       PRIMARY FLOW (STRICT LR)
       ============================================================ */

    DSL -> Proposal;
    ExternalSignals -> Proposal;

    Proposal -> Resolver;
    Resolver -> CanonicalIR;

    CanonicalIR -> Policy;
    Policy -> ProofSystem;
    ProofSystem -> Gate;

    Gate -> StateModel;

    StateModel -> DeltaEngine;
    DeltaEngine -> Kernel;

    Kernel -> Epochs;
    Epochs -> Ledger;
    Ledger -> Snapshot;

    Snapshot -> Interpreter;
    Interpreter -> Scheduler;
    Scheduler -> HostAdapter;

    HostAdapter -> EventStream;
    EventStream -> Scoring;
    Scoring -> Learning;

    /* ============================================================
       CONTROL CONSTRAINTS (NOT BACK-EDGES, BUT FEED-FORWARD)
       ============================================================ */

    Learning -> Policy;
}
