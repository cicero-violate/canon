digraph Tier7_Sovereign_AI {

    rankdir=LR;
    labelloc="t";
    label="Tier 7 Sovereign AI System (Deterministic, Judgment-Gated)";
    fontsize=20;

    node [shape=box, style=rounded, fontname="JetBrains Mono"];

    /* ===== LAYER 1: INPUT / WORLD ===== */

    Input        [label="External Input\n(DSL / User / Sensors)"];
    Resources    [label="Resource Layer\n(GPU / CPU / FS / Network)"];

    /* ===== LAYER 2: REPRESENTATION ===== */

    Parser       [label="Parser"];
    Resolver     [label="Resolver"];
    CanonicalIR  [label="Canonical IR\n(DAG Source of Truth)"];
    Snapshot     [label="Graph Snapshot\n(Deterministic State Image)"];

    /* ===== LAYER 3: MEMORY ===== */

    DeltaLog     [label="Delta Log\n(Append-Only Ledger)"];
    EpochMgr     [label="Epoch Manager"];
    StateStore   [label="Canonical State Store"];

    /* ===== LAYER 4: JUDGMENT ===== */

    Policy       [label="Policy Engine\n(Hard Law / Lints / Invariants)"];
    LeanGate     [label="Formal Gate\n(SMT / Lean Proof Check)"];
    IntentRadius [label="Intent Radius\n(Cost / Risk Bound)"];
    Judgment     [label="Judgment Kernel\n(Allow / Deny)"];

    /* ===== LAYER 5: PLANNING ===== */

    Planner      [label="Capability Planner"];
    Constraint   [label="Constraint Graph"];
    Plan         [label="Execution Plan"];

    /* ===== LAYER 6: EXECUTION ===== */

    Runtime      [label="System Runtime"];
    ShellDAG     [label="Shell DAG Engine"];
    GPUPipeline  [label="GPU MIR â†’ PTX Pipeline"];
    Materialize  [label="Materializer"];

    /* ===== LAYER 7: OBSERVE / LEARN ===== */

    Observer     [label="Observer"];
    Metrics      [label="Metrics Engine"];
    Scoring      [label="Score Function"];
    Update       [label="Graph Update"];

    /* ===== FLOW ===== */

    Input      -> Parser;
    Parser     -> Resolver;
    Resolver   -> CanonicalIR;
    CanonicalIR-> Snapshot;

    Snapshot   -> DeltaLog;
    DeltaLog   -> EpochMgr;
    EpochMgr   -> StateStore;

    CanonicalIR -> Policy;
    Policy      -> LeanGate;
    LeanGate    -> IntentRadius;
    IntentRadius-> Judgment;

    Judgment   -> Planner;
    Planner    -> Constraint;
    Constraint -> Plan;

    Plan       -> Runtime;
    Runtime    -> ShellDAG;
    Runtime    -> GPUPipeline;
    Runtime    -> Materialize;

    ShellDAG   -> Observer;
    GPUPipeline-> Observer;
    Materialize-> Observer;

    Observer   -> Metrics;
    Metrics    -> Scoring;
    Scoring    -> Update;
    Update     -> CanonicalIR;

    Resources  -> Runtime;
}
