// module_dag.dot
digraph Canon_Module_Dependency_DAG {
  rankdir = LR;
  labelloc = top;
  label = "Canon Level-7 Module Dependency DAG\nNodes are crates\n(A → B means B imports A)";
  fontsize = 18;
  fontname = "JetBrains Mono";

  node [
    shape=box,
    style=rounded,
    fontname="JetBrains Mono",
    fontsize=10
  ];
  edge [
    fontname="JetBrains Mono",
    fontsize=9
  ];

  /* ===== Core Law Layer ===== */
  kernel [
    label="kernel\n(CanonicalState · Delta · Kernel\nInvariantSet · RootHash · ApplyResult)"
  ];

  /* ===== Persistence Layer ===== */
  memory [
    label="memory\n(DeltaLedger · LedgerEntry\nSnapshotManager · ReplayEngine)"
  ];
  kernel -> memory [label="memory imports Delta, CanonicalState"];

  /* ===== Gate Layer ===== */
  judgment [
    label="judgment\n(IntentRadius · Policy · JudgmentResult\nJudgmentProof · PolicyDecision · JudgmentValidator)"
  ];
  kernel -> judgment [label="judgment imports RootHash, CanonicalState"];

  /* ===== Formal Proof Layer ===== */
  proof_gate [
    label="proof_gate\n(LeanBridge · ProofCertificate\nCertificateStore · ProofObligation)"
  ];
  kernel   -> proof_gate [label="proof_gate imports Delta, InvariantSet"];
  judgment -> proof_gate [label="proof_gate imports JudgmentProof"];

  /* ===== Intelligence Layer ===== */
  planner [
    label="planner\n(Planner · Plan · PlanStep\nIntent · LLMAdapter · HeuristicEngine)"
  ];
  judgment -> planner [label="planner imports PolicyDecision, IntentRadius"];
  kernel   -> planner [label="planner reads CanonicalState"];

  /* ===== Runtime Layer ===== */
  runtime [
    label="runtime\n(RuntimeCoordinator · ExecutionLoop\nBootLoader · ExecutionContext)"
  ];
  planner    -> runtime [label="runtime imports Planner"];
  judgment   -> runtime [label="runtime imports JudgmentValidator"];
  kernel     -> runtime [label="runtime imports Kernel"];
  memory     -> runtime [label="runtime imports DeltaLedger"];
  proof_gate -> runtime [label="runtime imports LeanBridge"];

  /* ===== Projection Layer ===== */
  projection [
    label="projection\n(GraphProjection · ProjectionNode\nMetricCollector · GraphExporter)"
  ];
  kernel -> projection [label="projection reads CanonicalState, Delta"];
  memory -> projection [label="projection reads DeltaLedger"];

  /* ===== Substrate Layer ===== */
  substrate [
    label="substrate\n(ShellExecutor · GpuExecutor\nNetworkClient · FilesystemAdapter)"
  ];
  substrate -> runtime [label="runtime imports substrate"];

  /* ===== Binary Entry Point ===== */
  canon_node [
    label="bin/canon-node\n(main · NodeConfig)",
    shape=component
  ];
  runtime -> canon_node [label="canon-node imports RuntimeCoordinator"];
}
